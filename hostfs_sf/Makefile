# defaults
TOP ?= ..
ARMIPS ?= armips

REGION ?= usa

# Set some stuff
PNACH_NAME = hostfs

OBJS := obj/$(REGION)/CPS2CDStore_ct.bin
SCRIPTS = generate_thunk_asm.py templates/thunk_header.jinja2 templates/thunk.jinja2
DEPS = obj/$(REGION)/hostfs_thunks.asm $(OBJS)
PNACH_JSON = obj/$(REGION)/patch.json

include $(TOP)/make/rules.mk

obj/:
	mkdir -p $@

obj/$(REGION)/: obj/
	mkdir -p $@

clean-user:
	rm -rf obj/

# The patch.json. Generated because it's easier that way
$(PNACH_JSON): obj/$(REGION)/ regions/$(REGION).inc make_patch_json.py
	./make_patch_json.py $(REGION) > $@

# The thunk assembly. Generated by the mentioned script.
obj/$(REGION)/hostfs_thunks.asm: obj/$(REGION)/ regions/$(REGION).inc $(SCRIPTS)
	./generate_thunk_asm.py $@ $(REGION)

# ASM products
$(eval $(call make_asm,obj/$(REGION)/hostfs_thunks.asm,obj/$(REGION)/CPS2CDStore_ct.bin))