# defaults
TOP ?= ..
ARMIPS ?= armips

REGION ?= usa

# crc for each thing
ifeq ($(REGION),usa)
PNACH_CRC = F32494AC
else
$(error invalid region)
endif

# Set some stuff
PNACH_NAME = hostfs

MAIN_BINARY = obj/$(REGION)/CPS2CDStore_ct.bin
SCRIPTS = generate_thunk_asm.py templates/thunk_header.jinja2 templates/thunk.jinja2
DEPS = obj/$(REGION)/hostfs_thunks.asm $(MAIN_BINARY)
PNACH_JSON = obj/$(REGION)/patch.json

include $(TOP)/make/rules.mk

obj/:
	mkdir -p $@

obj/$(REGION)/: obj/
	mkdir -p $@

clean-user:
	rm -rf obj/

# The patch.json. Generated because it's easier that way
$(PNACH_JSON): obj/$(REGION)/ regions/$(REGION).inc make_patch_json.py
	./make_patch_json.py $(REGION) > $@

# The thunk assembly. Generated by the mentioned script.
obj/$(REGION)/hostfs_thunks.asm: obj/$(REGION)/ regions/$(REGION).inc $(SCRIPTS)
	./generate_thunk_asm.py $@ $(REGION)

# the thunk binary. These are all generated by a single asm source file
# but we need to do it like this. Kind of stupid but whatever
obj/$(REGION)/CPS2CDStore_ct.bin: obj/$(REGION)/hostfs_thunks.asm
	$(ARMIPS) -sym obj/$(REGION)/thunk_symbols.sym $<